<!DOCTYPE html>
<html>

<head>
    <!-- <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet"> -->
    <CSS></CSS>
    <!-- <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script> -->
    <JS></JS>
</head>

<body>
    <div id="editor-container"> </div>
    <br><br><br>
    <div id="view-container"> </div>
    <script>
        /*const prevFn = window.postMessage;
        window.postMessage = (...arg) => {
            const msg = JSON.stringify(arg.shift());
            arg.unshift(msg);
            prevFn(...arg);
        }*/

        const editor = new Quill('#editor-container', {
            modules: {
                toolbar: [
                    [{ header: [1, 2, false] }],
                    ['bold', 'italic', 'underline'],
                    ['image', 'video', 'code-block']
                ]
            },
            theme: 'snow' // or 'bubble'
        });

        const view = new Quill('#view-container', {
            readOnly: true,
            modules: {
                toolbar: false
            },
            theme: 'snow' // or 'bubble'
        });

        const example = {
            "ops": [{
                "insert": {
                    "video": "https://www.youtube.com/embed/xvVsaU9l-3I?showinfo=0"
                }
            },
            {
                "insert": "\n"
            },
            {
                "insert": "This is a video."
            }]
        };

        editor.setContents(example);
        view.setContents(example);

        editor.on('text-change', function (delta, oldDelta, source) {
            //document.body.innerHTML = 'WERKEND';
            view.setContents(editor.getContents());
            window.postMessage(JSON.stringify(editor.getText()));
            window.postMessage(JSON.stringify(editor.getContents()));
            if (source == 'api') {
                console.log("An API call triggered this change.");
            } else if (source == 'user') {
                console.log("A user action triggered this change.");
            }
        });
    </script>
</body>

</html>